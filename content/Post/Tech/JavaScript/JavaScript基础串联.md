## æ‰§è¡Œä¸Šä¸‹æ–‡

è°ƒç”¨å‡½æ•°æ—¶ï¼Œ`JavaScript`åˆ›å»ºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡å‹å…¥è°ƒç”¨æ ˆã€‚

æ‰§è¡Œä¸Šä¸‹æ–‡åŒ…å«ï¼š

- è¯æ³•ç¯å¢ƒ
  - ç¯å¢ƒè®°å½•ï¼ˆEnvironment Recordï¼‰ï¼šå­˜æ”¾å±€éƒ¨å˜é‡`const/let`å£°æ˜çš„å˜é‡å’Œå‡½æ•°å£°æ˜
  - å¤–å±‚å¼•ç”¨ï¼ˆouterï¼‰
    - å‡½æ•°å®šä¹‰æ—¶ï¼Œå‡½æ•°çš„`[[Environment]]`éšè—å±æ€§è®°å½•å¯¹å¤–å±‚è¯æ³•ç¯å¢ƒçš„å¼•ç”¨ï¼Œåˆ›å»ºè¯æ³•ç¯å¢ƒæ—¶`outer`é€šè¿‡`[[Environment]]`å¾—åˆ°å¼•ç”¨
    - **ä½œç”¨åŸŸé“¾**ï¼šå½“è®¿é—®ä¸€ä¸ªå½“å‰è¯æ³•ç¯å¢ƒå…§ç¼ºå¤±çš„å˜é‡æ—¶ï¼Œæ²¿ç€å¤–å±‚å¼•ç”¨é“¾åˆ°å¤–å±‚è¯æ³•ç¯å¢ƒä¸­æ‰¾ï¼Œç›´è‡³æ‰¾åˆ°æˆ–åˆ°æ ¹éƒ¨åœæ­¢
    - **é—­åŒ…**ï¼šå†…éƒ¨å‡½æ•°æ€»èƒ½è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡å’Œå‡½æ•°ï¼Œå› ä¸º`[[Environment]]`ä¸€ç›´éƒ½åœ¨ï¼Œèƒ½ä¸€ç›´æ‰¾åˆ°å¤–å±‚è¯æ³•ç¯å¢ƒã€‚åªè¦è¯æ³•ç¯å¢ƒå¯è¾¾ï¼Œå³ä½¿å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œå…¶è¯æ³•ç¯å¢ƒä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚
  - Thisç»‘å®šï¼ˆThis Bindingsï¼‰
    - `object.method()`
      - ä»¥å¯¹è±¡æ–¹æ³•çš„å½¢å¼è°ƒç”¨æ—¶ï¼Œç‚¹ç¬¦å·è¿”å›ä¸€ä¸ªä¸­é—´å€¼`(base, name, strict)`ä¼ é€’ç»™è°ƒç”¨æ‹¬å·ã€‚å¦‚æœä½¿ç”¨`obj = object.method`å†è°ƒç”¨`obj()`ï¼Œå¼•ç”¨ç±»å‹è¢«ä¸¢å¼ƒï¼Œè°ƒç”¨æ—¶ä¹Ÿå°±æ— æ³•å¾—åˆ°åŸæœ‰`this`ä¿¡æ¯ï¼Œé‚£ä¹ˆå¦‚ä½•ä½¿å‡½æ•°è°ƒç”¨ä¸€ç›´ä¿æŒåŸæœ‰`this`ä¿¡æ¯å‘¢ï¼ŸğŸ‘€å‡½æ•°ç»‘å®š
    - å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œ`this`æŒ‡å‘`global`
    - æ™®é€šå‡½æ•°è°ƒç”¨ï¼Œéä¸¥æ ¼æ¨¡å¼æŒ‡å‘`global`ï¼Œä¸¥æ ¼æ¨¡å¼æŒ‡å‘`undefined`
    - `apply/call`
    - æ„é€ å‡½æ•°ä¸­è°ƒç”¨
- å˜é‡ç¯å¢ƒï¼šä¿å­˜`var`å£°æ˜çš„å˜é‡



### å‡½æ•°ç»‘å®š

`func.bind(context, arg1, arg2)`

å‡½æ•°ç»‘å®šåè¿”å›ä¸€ä¸ªç±»ä¼¼å‡½æ•°çš„ç‰¹æ®Šå¯¹è±¡ï¼Œè°ƒç”¨å®ƒæ—¶ï¼Œå®ƒä¼šæŠŠè°ƒç”¨ä¼ é€’ç»™`func`ï¼Œå¹¶è®¾ç½®`this=context`ï¼Œ

P.S. `.bind(context[,...args])`ä¹Ÿå¯ä»¥æŒ‡å®šå‚æ•°æ¥äº§ç”Ÿåå‡½æ•°å“Ÿã€‚



## åŸå‹

å¯¹è±¡éƒ½æœ‰éšè—å±æ€§`[[Prototype]]`ï¼Œç§°ä¸ºåŸå‹ï¼Œ`[[Prototype]]`æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡æ—¶æ„æˆåŸå‹é“¾ã€‚å½“ä»å¯¹è±¡ä¸­è¯»å–ä¸€ä¸ªç¼ºå¤±çš„å±æ€§æ—¶ï¼Œ`JavaScript`ä¼šè‡ªåŠ¨å»¶åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ã€‚

`__proto__`å±æ€§æ˜¯`[[Prototype]]`çš„ä¸€ä¸ª`getter/setter`ã€‚

åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨`Object.getPrototypeOf(obj)`å’Œ`Object.setPrototypeOf(obj)`è®¿é—®åˆ°`[[Prototype]]`



å‡½æ•°å¯¹è±¡éƒ½æœ‰`prototype`å±æ€§ï¼Œé»˜è®¤æ˜¯`{constructor: function}`ï¼ˆåªæœ‰ä¸€ä¸ª`constructor`å±æ€§çš„å¯¹è±¡ï¼Œ`constructor`æŒ‡å‘è‡ªèº«ï¼‰

![](JavaScriptåŸºç¡€ä¸²è”.assets/prototype.png)

æ„é€ å‡½æ•°ç”¨äºå°è£…åˆ›å»ºå¯¹è±¡é€»è¾‘ï¼Œè¾¾åˆ°å¯å¤ç”¨çš„æ•ˆæœã€‚æœ¬è´¨æ˜¯å¸¸è§„å‡½æ•°ï¼Œé™„åŠ ä¸Šå‡½æ•°åé¦–å­—æ¯å¤§å†™å’Œä½¿ç”¨`new`è°ƒç”¨çš„ä¸¤ä¸ªçº¦å®šã€‚ä½¿ç”¨`new`è°ƒç”¨å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

`new F()`åšäº†ä»€ä¹ˆï¼Ÿï¼š

- åˆ›å»ºç©ºçš„å¯¹è±¡A
- å°†Açš„`[[Prototype]]`æŒ‡å‘**`F.prototype`**
- å°†Aä½œä¸ºä¸Šä¸‹æ–‡ï¼Œæ‰§è¡Œ`F`å†…éƒ¨é€»è¾‘
- è¿”å›è¿”å›å€¼æˆ–è€…è¿”å›A

``` javascript
function _new() { 
    // 4.1ã€æˆ‘ä»¬å¤„ç†å‚æ•°
    // æ£€éªŒç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸æ˜¯å‡½æ•°ã€‚ä¸æ˜¯å‡½æ•°è¿”å›æç¤ºä¿¡æ¯
    if (Object.prototype.toString.call(arguments[ 0 ]) !== "[object Function]") {
        throw "The first parameter must be a function.";
    }
    
    // 4.2ã€åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å•JavaScriptå¯¹è±¡ï¼ˆå³{}ï¼‰ï¼›
    
    var obj = {};
    
    // 4.3ã€é“¾æ¥è¯¥å¯¹è±¡ï¼ˆå³è®¾ç½®è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰åˆ°å¦ä¸€ä¸ªå¯¹è±¡(æˆ‘è®¤ä¸ºè¯´çš„æ˜¯ç›®æ ‡å‡½æ•°å¯¹è±¡ï¼Œç»‘å®šåŸå‹) ï¼›
    obj.__proto__ = arguments[ 0 ].prototype;
    
    // 4.4ã€å°†æ­¥éª¤1æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸ºthisçš„ä¸Šä¸‹æ–‡ï¼ˆå¤§æ¦‚æ˜¯åˆ‡æ¢ thisçš„æ„æ€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ apply è¿›è¡Œå‚æ•°ä¼ é€’ï¼‰ï¼›
    var res = arguments[ 0 ].apply(obj, Array.prototype.slice.call(arguments).slice(1));
    
    // 4.5ã€å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å›thisï¼ˆå¤§æ¦‚æ„æ€æ˜¯è¯´ç›®æ ‡å‡½æ•°ä¸å­˜åœ¨è¿”å›å€¼æ—¶ï¼Œè¿”å›æ–°å¯¹è±¡ï¼Œå¦åˆ™è¿”å›ç›®æ ‡å‡½æ•°çš„è¿”å›å€¼ï¼‰ã€‚
    // ç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨ new æ“ä½œç¬¦æ—¶ï¼Œ
    // ç›®æ ‡å‡½æ•°è¿”å›å€¼æ˜¯ Object å°±è¿”å›ç›®æ ‡å‡½æ•°çš„è¿”å›å€¼ï¼Œ
    // å¦åˆ™å°±è¿”å›æ–°å¯¹è±¡
    return ( res instanceof Object ) ? res : obj;
}
```



- `F`çš„å†…éƒ¨é€»è¾‘åˆå§‹åŒ–å¯¹è±¡å±æ€§
- `F`çš„åŸå‹æ‰¿è½½æ–¹æ³•

``` javascript
function User(name) {
  this.name = name;
}
// ä»»ä½•å‡½æ•°åŸå‹é»˜è®¤éƒ½å…·æœ‰æ„é€ å™¨å±æ€§ï¼Œ
// æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå®ƒ

// 2. å°†æ–¹æ³•æ·»åŠ åˆ°åŸå‹
User.prototype.sayHi = function() {
  alert(this.name);
};

let user = new User("John");
user.sayHi();
```



è¿™å¾ˆå®¹æ˜“è®©äººæƒ³åˆ°â€œç±»â€

``` javascript
// class User
class User {
  constructor (name) {
    this.name = name;
  }
  sayHi () {
    alert(this.name);
  }
}
```

æŠ€æœ¯ä¸Šæ¥è¯´ï¼Œ`User` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨æ˜¯`constructor`çš„å†…å®¹ï¼Œ`methods`ã€`getters` å’Œ `setters` éƒ½è¢«å†™å…¥äº† `User.prototype`ã€‚

çº¯å‡½æ•°å®šä¹‰çš„ç±»å’Œä½¿ç”¨`Class`å®šä¹‰çš„ç±»æœ‰ä¸€äº›å·®å¼‚ï¼š

- é€šè¿‡ `class` åˆ›å»ºçš„å‡½æ•°å…·æœ‰ç‰¹æ®Šçš„å†…éƒ¨å±æ€§æ ‡è®° `[[FunctionKind]]:"classConstructor"`ï¼Œè°ƒç”¨ç±»æ„é€ å™¨æ—¶å¿…é¡»è¦ç”¨ `new` å…³é”®è¯ã€‚
- ç±»æ–¹æ³•ä¸å¯æšä¸¾ï¼Œ`enumerable`æ ‡å¿—è®¾ç½®ä¸º`false`ï¼›åœ¨`for...in...`ä¸­ç±»æ–¹æ³•ä¸ä¼šå‡ºç°ã€‚
- ç±»æ€»æ˜¯ä½¿ç”¨ `use strict`ã€‚



## ç»§æ‰¿

æ¯ä¸ªå‡½æ•°éƒ½æœ‰`prototype`ï¼Œé»˜è®¤å†…å®¹æ˜¯`{constructor: function}`ï¼Œä¸€ä¸ªå¯¹è±¡ã€‚

ä¸€ä¸ªå¯¹è±¡æœ‰`[[Prototype]]`ï¼Œè¿æ¥å…¶ä»–å¯¹è±¡å½¢æˆåŸå‹é“¾ä¾¿å¯ä»¥è®¿é—®è¿æ¥å¯¹è±¡ä¸Šçš„æ–¹æ³•ã€‚

`Func.prototype.__proto__ === Function.prototype`

æ‰€æœ‰å†…å»ºå¯¹è±¡æœ€ç»ˆéƒ½è¿æ¥åˆ°`Object.prototype -> null`ï¼Œå› æ­¤è¯´`JavaScript`ä¸­ä¸€åˆ‡éƒ½æ¥è‡ªå¯¹è±¡ã€‚

æƒ³è¦åˆ‡æ–­è¿™ä¸ªé»˜è®¤å…³è”ï¼Œå¯ä»¥ä½¿ç”¨`Object.create(null);`



![](./assets/Object.prototype.png)



ç±»ç»§æ‰¿

```javascript
class Child extends Parent {}
```

æœ¬è´¨ä¸Šåšäº†ä¸¤ä»¶äº‹ï¼š

- ç»§æ‰¿æ–¹æ³•ï¼š`Child.prototype`çš„`[[Prototype]]`æŒ‡å‘`Parent.prototype`

- ç»§æ‰¿é™æ€æ–¹æ³•ï¼š`Child.__proto__ === Parent`ï¼Œå†…å»ºå¯¹è±¡ä¸ä¼šç»§æ‰¿`Object`çš„é™æ€æ–¹æ³•(`Object.keys`/`Object.values`ä¹‹ç±»)



``` javascript
new Child()
```

- è°ƒç”¨`Parent`çš„`constructor`ï¼Œå¦‚æœ`Child`ä¸­æœ‰é‡å†™`constructor`ï¼Œéœ€è¦é€šè¿‡`super()`è°ƒç”¨`Parent`çš„`constructor`ï¼ˆï¼‰
- å°†å¯¹è±¡çš„`[[Prototype]]`æŒ‡å‘`Child.prototype`

ç±»æ£€æŸ¥

`obj instanceof Class`/`Class.isPrototypeOf(obj)`ï¼Œæ²¿ç€`obj`åŸå‹é“¾æ˜¯å¦èƒ½æ‰¾åˆ°`Class.prototype`

`({}).toString.call(obj)`ï¼Œè°ƒç”¨`obj[Symbol.toStringTag]`æ–¹æ³•è·å–Strï¼Œè¿”å›`[Object Str]`





## å¯è¿­ä»£(iterable)

**å¯è¿­ä»£å¯¹è±¡(iterable object)**ï¼šæ‹¥æœ‰`[Symbol.iterator]`æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•è·å¾—**è¿­ä»£å™¨(iterator)**ï¼Œ`for...of...`æ˜¯ä¸€ä¸ªèƒ½å¤Ÿéå†å®ƒçš„å¾ˆå¥½çš„è¯­æ³•ã€‚

å¯è¿­ä»£å¯¹è±¡æ˜¯æ•°ç»„/å­—ç¬¦ä¸²çš„æ³›åŒ–ï¼Œæ•°ç»„/å­—ç¬¦ä¸²æœ‰å¯è¿­ä»£çš„ç‰¹æ€§ï¼Œä½†å¯è¿­ä»£å¯¹è±¡ä¸æ˜¯æ•°ç»„æ— æ³•ä½¿ç”¨æ•°ç»„å…ƒç´ çš„æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡`Array.from()`è½¬æ¢ä¸ºæ•°ç»„ä½¿ç”¨ã€‚

åŒæ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰`[Symbol.iterator]`æ–¹æ³•è‡ªå»ºå¯è¿­ä»£å¯¹è±¡ã€‚

**è¿­ä»£å™¨(iterator)**ï¼šä¸€ä¸ªæœ‰`next`æ–¹æ³•çš„çš„å¯¹è±¡ï¼Œ`next`æ–¹æ³•è¿”å›`{value:..., done:...}`å¯¹è±¡ã€‚è°ƒç”¨`next`è¿›å…¥ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚



**Generatorå‡½æ•°**è°ƒç”¨çš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ª**ç”Ÿæˆå™¨å¯¹è±¡ï¼ˆgeneratorï¼‰**ï¼Œç”Ÿæˆå™¨å¯¹è±¡æ˜¯å¯è¿­ä»£çš„ï¼Œä¸Šé¢æœ‰`next`æ–¹æ³•ã€‚`generator.next()`æ¢å¤Generatorå‡½æ•°å—å…§ä»£ç æ‰§è¡Œï¼Œæ‰§è¡Œåˆ°æœ€è¿‘çš„`yield`è¯­å¥ï¼Œå¹¶ä¸”è¿”å›`{value:.., done:...}`å¯¹è±¡ï¼š

- `value`: äº§å‡ºçš„ï¼ˆyieldï¼‰çš„å€¼ã€‚
- `done`: å¦‚æœ generator å‡½æ•°å·²æ‰§è¡Œå®Œæˆåˆ™ä¸º `true`ï¼Œå¦åˆ™ä¸º `false`ã€‚

``` javascript
function* generateSequence () {
  yield 1;
  yield 2;
  yield 3;
}

let generator = generateSequence();

let one = generator.next();

alert(JSON.stringify(one)); // {value: 1, done: false}
```



